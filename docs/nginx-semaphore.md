---
tag:
- nginx
---

# nginx: semaphore

Nginx中的信号量。

## 函数

### new

创建一个信号量。支持参数num，指定信号量初始的资源数量。

### post

释放指定数量的资源。默认值为1,即释放一个资源。支持参数num，指定释放资源的数量。

### wait

获取一个资源。支持参数 wait_ms，指定最长等待时间。
底层实现为添加一个定时器，该定时器使用的是调用wait函数的时间戳，该时间戳由nginx缓存时间加上指定的等待时间。（nginx 缓存的时间戳可能过时，导致实际等待时间远小于 wait_ms。）

### count

获取当前正在等待资源的数量。返回一个负数，其绝对值为正在等待资源的数量。
